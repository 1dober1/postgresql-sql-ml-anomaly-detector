# Подключение к PostgreSQL
DB_HOST=localhost                # Хост Postgres / имя сервиса в Docker-сети
DB_PORT=5432                     # Порт Postgres
DB_NAME=postgres                 # Имя БД
DB_USERNAME=postgres             # Пользователь
DB_PASSWORD=secret               # Пароль

# Telegram-уведомления (опционально)
TELEGRAM_BOT_TOKEN=secret        # Токен бота от @BotFather
TELEGRAM_CHAT_ID=secret          # ID чата (для групп обычно отрицательный)

# Модель/артефакты
MODEL_FILE=model_demo_v1.pkl     # Куда сохранять/откуда грузить модель (путь относительно cwd)
MODEL_VERSION=demo_v1            # Пишется в monitoring.anomaly_scores.model_version

# Обучение (IsolationForest)
MODEL_CONTAMINATION=0.02         # Ожидаемая доля выбросов; можно `auto`
MODEL_MIN_ROWS=500               # Мин. строк для обучения после фильтрации; иначе boot.py продолжит собирать baseline
MODEL_MIN_QUERYIDS=10            # Мин. уникальных (dbid,userid,queryid) в трейне
MODEL_MAX_SAMPLES_PER_QUERYID=50 # Ограничение выборки на один queryid (защита от доминирования частых запросов)

# Порог аномалий
MODEL_ALERT_QUANTILE=0.002       # Автопорог: квантиль score на трейне (0.002 = нижние 0.2%)
ALERT_SCORE_THRESHOLD=auto       # `auto` — использовать порог из модели; или число (например -0.01)
ALERT_TOP_K=5                    # Макс. Telegram-алертов за один прогон (0 = без лимита)

# Цикл сбора/детекции
COLLECT_INTERVAL=10              # Интервал (сек) между итерациями пайплайна в boot.py
DETECT_BATCH_LIMIT=2000          # Макс. окон за один запуск детекта
RETRAIN_INTERVAL=3600            # Интервал (сек) планового переобучения (boot.py)

# (Опционально) Управление bootstrap (boot.py)
# TRAIN_COLLECT_ITERATIONS=40     # Сколько итераций собрать перед первичным обучением
# TRAIN_COLLECT_SLEEP=10          # Пауза (сек) между bootstrap-итерациями
# TRAIN_RETRY_LIMIT=10            # Сколько раз повторять bootstrap+train, если данных мало

# Drift detection (триггер переобучения по серии "существенных" алертов)
DRIFT_CONSECUTIVE_LIMIT=10       # Сколько подряд "существенных" прогонов нужно для дрифта
DRIFT_SIGNIF_EXEC_MS=20          # Существенно, если exec_time_per_call_ms >= этого значения
DRIFT_SIGNIF_WAL_BYTES=200000    # Существенно, если wal_bytes_per_call >= этого значения
DRIFT_SIGNIF_SHARED_READ=200     # Существенно, если shared_read_per_call >= этого значения
DRIFT_SIGNIF_ROWS=50000          # Существенно, если rows_per_call >= этого значения
